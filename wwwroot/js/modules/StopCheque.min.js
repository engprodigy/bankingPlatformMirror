function validate(){var text=$("input[name=stop-value]").val().trim(),values;if(!text.length)return utilities.createError("Stop value is required");values=text.split(",");values=$.map(values,function(el){var trimmed=el.trim();return trimmed.length?trimmed:null});var errors=[],single=[],ranged=[];if($.each(values,function(index,val){return val.lastIndexOf("-")>0?utilities.validateRanged(val,chequebook.start,chequebook.end)?ranged.push(val):errors.push("> "+val):utilities.validateSingle(val,chequebook.start,chequebook.end)?single.push(val):errors.push("> "+val)}),errors.length>0)return utilities.createError("The following stop values are invalid:<br>"+errors.join("<br>"));if($.each(chequeLeaves.used,function(index,item){$.inArray(item.leafno.toString(),single)>=0&&errors.push("> "+item.leafno)}),$.each(chequeLeaves.used,function(index,item){var val,splitted;for(val of ranged)if(splitted=val.split("-"),item.leafno>=Number(splitted[0])&&item.leafno<=Number(splitted[1])){errors.push("> "+val+": "+item.leafno);break}}),errors.length>0)return utilities.createError("The following stop value(s)/range(s) are already used or contain cheques that have been used :<br>"+errors.join("<br>"));save(single,ranged)}function save(single_arr,ranged_arr){var total=$.map(single_arr,function(item){return Number(item)});$.each(ranged_arr,function(index,value){total=total.concat(utilities.range($.map(value.split("-"),function(el){return Number(el)})))});swal({title:"Are you sure?",text:"Cheque leaves will be stopped",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(isConfirm){isConfirm&&($("#StopLeavesButton").attr("disabled",!0),$.ajax(url_path+"/../StopCheques",{method:"POST",contentType:"application/json",data:JSON.stringify({tostop:total,chequebookid:chequebook.id,stopped:$.map(chequeLeaves.stopped,function(item){return item.leafno})})}).then(function(){swal({title:"Stop Cheque Leaves",text:"Cheque leaves successfully stopped!",type:"success",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$("#StopLeavesButton").removeAttr("disabled");$("#chequeModal").modal("hide")})},function(){swal({title:"Stop Cheque Leaves",text:"An error occured while stopping cheques. Please try again",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$("#StopLeavesButton").removeAttr("disabled")})}))},function(){return})}function openModal(id){$.ajax(url_path+"/../LoadChequeLeaves/"+id).then(function(response){var row,modal;chequeLeaves=response;row=$("#cheques-data-table").bootstrapTable("getRowByUniqueId",id);chequebook.start=row.startrange;chequebook.end=row.endrange;chequebook.id=row.id;modal=$("#chequeModal");modal.find("#cheque-status-detail").text(row.accountno+" - "+row.chequebooktype.chequetype);modal.find("#start").val(row.startrange);modal.find("#end").val(row.endrange);modal.find("[name=stop-value]").val("");$("#chequeModal").modal("show")},function(){swal("An exception occured")})}var url_path=window.location.pathname,chequeLeaves,chequebook,utilities;url_path.charAt(url_path.length-1)=="/"&&(url_path=url_path.slice(0,url_path.length-1));chequebook={};$(document).ready(function(){$(".modal").perfectScrollbar()});utilities={chequeDetailFormatter:function(index,row,el){var container=$("<div class='row mx-0'><\/div>");container.append($("<div class='col-xs-12 col-md-6 mb-3 mt-2'><b>Charge:<\/b> <span class='float-right'>"+row.charge+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-3 mt-2'><b>Counter Cheque:<\/b> <span class='float-right'>"+(row.iscountercheque?"Yes":"No")+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-2'><b>Remark:<\/b> <span class='float-right'>"+(row.remark==null?"-":row.remark)+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-2'><b>Date Created:<\/b> <span class='float-right'>"+moment(row.datecreated).format("MMMM DD, YYYY")+"<\/span><\/div>"));el.append(container)},blockChequeBtnFormatter:function(val,row){return["<button class='btn btn-danger btn-icon' ","onclick='openModal("+row.id+")'>","<i class='now-ui-icons ui-1_settings-gear-63'>","<\/i><\/button>"].join("")},createChequeStatusHelpher:function(id){var el=document.createElement("span");return el.setAttribute("id",id),el.textContent=id,el.setAttribute("class","cheque-status-box bg-success"),el},createError:function(error){$.notify({icon:"now-ui-icons travel_info",message:error},{type:"danger",placement:{from:"top",align:"right"}})},strictParseInt:function(subject){return/^[0-9]+$/.test(subject)?Number(subject):NaN},validateSingle:function(val,start,end){return isNaN(utilities.strictParseInt(val))?!1:parseInt(start)>parseInt(val)||parseInt(end)<parseInt(val)?!1:!0},validateRanged:function(val,start,end){var splitArray=val.split("-");return splitArray.length!==2?!1:(splitArray=$.map(splitArray,function(el){return $.trim(el)}),!(parseInt(splitArray[1])>parseInt(splitArray[0])))?!1:utilities.validateSingle(splitArray[0],start,end)?utilities.validateSingle(splitArray[1],start,end)?!0:!1:!1},range:function(tuple){for(var start=tuple[0],end=tuple[1],list=[],counter=start;counter<=end;counter++)list.push(counter);return list}};