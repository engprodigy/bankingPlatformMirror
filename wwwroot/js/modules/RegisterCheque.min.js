function initSelectTwoConfig(){$.fn.select2.defaults.set("theme","bootstrap4");$.fn.select2.defaults.set("dropdownParent",$(".modal").first());$.fn.select2.defaults.set("width","100%");$.fn.select2.defaults.set("allowClear",!0);$.ajax(url_path+"/../../Setup/LoadChequeTypes").then(function(response){$.each(response,function(index,item){chequebooktypes[item.id]=item});$("#chequebooktypeid").select2({placeholder:"Select chequebook type",data:$.map(response,function(item){return{id:item.id,text:item.chequetype}})})});$.ajax(url_path+"/../LoadCurrentAccounts").then(function(response){$("#accountno").select2({placeholder:"Select account",data:response})});$(document).on("select2:open",function(){$(".select2-results__options").perfectScrollbar()});$("#chequebooktypeid").on("select2:select",function(e){selectedChequebook=chequebooktypes[e.params.data.id];$("[name=leavesno]").val(selectedChequebook.leavesno);$("[name=charge]").val(selectedChequebook.charge);$("[name=startrange]").removeAttr("disabled");$("[name=startrange]").val().length>0&&$("[name=endrange]").val(parseInt($("[name=startrange]").val())+parseInt(selectedChequebook.leavesno)-1)});$("#chequebooktypeid").on("select2:unselect",function(){$("[name=leavesno]").val(null);$("[name=charge]").val(null);$("[name=startrange]").val(null).attr("disabled",!0);$("[name=endrange]").val(null)});$("#accountno").on("select2:select",function(e){accountcheques=REQUEST_IN_PROGRESS;$.ajax(url_path+"/../LoadAccountCheques/"+e.params.data.id).then(function(response){accountcheques=response},function(){accountcheques=null;swal({title:"Validate Cheque",type:"error",text:"There was an error validating the cheque number ranges. Please try again."})})});$("#accountno").on("select2:unselect",function(){accountcheques=undefined});$("[name=startrange]").on("input",function(e){$(e.target).valid()&&$("[name=endrange]").val(parseInt(e.target.value)+parseInt(selectedChequebook.leavesno)-1)})}function initFormValidations(){jQuery.validator.setDefaults({onfocusout:!1,onkeyup:!1,onclick:!1,normalizer:function(value){return $.trim(value)},errorPlacement:function(error){$.notify({icon:"now-ui-icons travel_info",message:error.text()},{type:"danger",placement:{from:"top",align:"right"}})}});$("#cheque-form").validate({rules:{startrange:{digits:!0}},messages:{accountno:{required:"Account no. is required"},chequebooktypeid:{required:"Cheque book type is required"},startrange:{required:"Chequebook start range is required",digits:"Chequebook start range can only contain digits"}}})}function openNewModal(){$("#cheque-form").closest("div.row").hide();$("#cheque-table").closest("div.row").show();$("#registerChequeModal").modal("show")}function AddCheque(){var form=$("#cheque-form"),startRange,valid,data;form.valid()&&(startRange=form.find("[name=startrange]").val(),valid=utilities.validateChequeNo(Number(startRange)),valid)&&(data={accountno:form.find("[name=accountno]").val(),chequebooktypeid:form.find("[name=chequebooktypeid]").val(),leavesno:form.find("[name=leavesno]").val(),charge:form.find("[name=charge]").val(),startrange:startRange,endrange:form.find("[name=endrange]").val(),iscountercheque:form.find("[name=iscountercheque]").prop("checked"),tracker:++tracker},$("#cheque-table").bootstrapTable("append",data),utilities.showChequeTable())}function Save(){var tableData=$("#cheque-table").bootstrapTable("getData");if(tableData.length==0)return $.notify({icon:"now-ui-icons travel_info",message:"There are no entries to submit! Add new cheque request(s)"},{type:"danger",placement:{from:"top",align:"right"}});swal({title:"Are you sure?",text:"Cheque request(s) will be submitted",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(isConfirm){if(isConfirm){var remark=$.trim($("[name=remark]").val());remark.length>0&&(tableData=$.map(tableData,function(item){return item.remark=remark,item}));$.ajax(url_path+"/../AddChequeRequests",{method:"POST",contentType:"application/json",data:JSON.stringify(tableData)}).then(function(){$("#cheque-table").bootstrapTable("removeAll");$("[name=remark]").val(null);swal({title:"Cheque request(s)",type:"success",text:"Cheque request(s) submitted successfully!"});$("#register-cheque-table").bootstrapTable("refresh");$("#registerChequeModal").modal("hide")},function(){swal({title:"Cheque request(s)",type:"error",text:"There was an error submitting the record(s). Please try again."})})}},function(){return})}var url_path=window.location.pathname,utilities;url_path.charAt(url_path.length-1)=="/"&&(url_path=url_path.slice(0,url_path.length-1));var chequebooktypes={},selectedChequebook,tracker=0,accountcheques=undefined,REQUEST_IN_PROGRESS="request_in_progress";$(document).ready(function(){initFormValidations();initSelectTwoConfig();$(".modal").perfectScrollbar()});utilities={animDuration:400,validateChequeNo:function(startRange){var dataTable,accountNo,highestEndRange;return accountcheques==undefined||accountcheques==REQUEST_IN_PROGRESS?setTimeout(utilities.validateChequeNo,1e3,startRange):(dataTable=$("#cheque-table").bootstrapTable("getData"),accountNo=$("#cheque-form").find("[name=accountno]").val(),dataTable=$.map(dataTable,function(item){return item.accountno!==accountNo?null:{accountno:item.accountno,start:Number(item.startrange),end:Number(item.endrange)}}),accountcheques.length==0&&dataTable.length==0)?!0:(highestEndRange=accountcheques.reduce(function(a,b){return Math.max(a,b.end)},0),highestEndRange=dataTable.reduce(function(a,b){return Math.max(a,b.end)},highestEndRange),startRange<=highestEndRange)?(swal({title:"Validate Cheque",type:"error",text:"The cheque start range has been used. Please use a number greater than "+highestEndRange}),!1):!0},deleteChequeFormatter:function(val,row){return["<button class='btn btn-danger btn-icon' ","onclick='utilities.removeCheque("+row.tracker+")'>","<i class='now-ui-icons ui-1_simple-remove'>","<\/i><\/button>"].join("")},removeCheque:function(tracker){$("#cheque-table").bootstrapTable("removeByUniqueId",tracker)},chequeDetailFormatter:function(index,row,el){var container=$("<div class='row mx-0'><\/div>");container.append($("<div class='col-xs-12 col-md-6 mb-3 mt-2'><b class='pull-left'>Start Range:<\/b> <span class='pull-right'>"+row.startrange+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-3 mt-2'><b class='pull-left'>End Range:<\/b> <span class='pull-right'>"+row.endrange+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-2'><b class='pull-left'>Remark:<\/b> <span class='pull-right'>"+(row.remark==null?"-":row.remark)+"<\/span><\/div>"));container.append($("<div class='col-xs-12 col-md-6 mb-2'><b class='pull-left'>Date Created:<\/b> <span class='pull-right'>"+moment(row.datecreated).format("MMMM DD, YYYY")+"<\/span><\/div>"));el.append(container)},counterChequeFormatter:function(val){return val?"Yes":"No"},chequeTypeDetailFormatter:function(val){return chequebooktypes[val].chequetype},showChequeForm:function(){$("#cheque-form").trigger("reset");$("#cheque-form select").val(null).trigger("select2:unselect").trigger("change");$("#cheque-table").closest("div.row").slideToggle({duration:utilities.animDuration,queue:!1});$("#cheque-form").closest("div.row").slideToggle({duration:utilities.animDuration,queue:!1})},showChequeTable:function(){$("#cheque-table").closest("div.row").slideToggle({duration:utilities.animDuration,queue:!1});$("#cheque-form").closest("div.row").slideToggle({duration:utilities.animDuration,queue:!1})}};